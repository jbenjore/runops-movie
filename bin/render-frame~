#!/bin/bash
set -e

DIR=$1
IN=$2
OUT=$3

function frame () {
    echo "frame-$*"
    time eval "/opt/perl/bin/perl frame-$*"
}

frame read\
    --in $IN\
    --dir $DIR
find $DIR -ls
frame make-graph\
    --dir $DIR
find $DIR -ls
frame deparent\
    --dir $DIR
find $DIR -ls
frame sum-size\
    --dir $DIR
frame names\
    --dir $DIR\
    --less-mem
frame png\
    --dir $DIR\
    --png $OUT
#open $OUT