#!/bin/bash
set -e

function frame () {
    echo "frame-$*"
    time eval "DYLD_INSERT_LIBRARIES=/usr/lib/libduma.dylib /opt/perl/bin/perl frame-$*"
}

frame read\
    --in ooo/perlcritic.log\
    --dir ooo
frame make-graph\
    --dir ooo\
    --less-mem
frame deparent\
    --dir ooo\
    --less-mem
frame sum-size\
    --dir ooo\
    --less-mem
frame names\
    --dir ooo\
    --less-mem
frame png\
    --dir ooo\
    --png ooo/perlcritic.png\
    --less-mem
open ooo/perlcritic.png