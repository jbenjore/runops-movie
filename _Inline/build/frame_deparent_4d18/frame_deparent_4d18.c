/*
 * This file was generated automatically by ExtUtils::ParseXS version 2.19_01 from the
 * contents of frame_deparent_4d18.xs. Do not edit this file, edit frame_deparent_4d18.xs instead.
 *
 *	ANY CHANGES MADE HERE WILL BE LOST! 
 *
 */

#line 1 "frame_deparent_4d18.xs"
#include "EXTERN.h"
#include "perl.h"
#include "XSUB.h"
#include "INLINE.h"
#line 119
#include <Judy.h>
void
deparent( PerlIO *ifh, PerlIO *ofh, void *rulledge, void *arity ) {
    SV *line_sv;
    char *line;
    Pvoid_t *pxedge;
    PWord_t pxarity;
    Word_t x,y,best_x,best_x_arity;
    STRLEN line_len;
    int found_x;

    /* for each line */
    line_sv = newSVpv("",0);
    while (sv_gets(line_sv,ifh,0)) {
        line = SvPV(line_sv,line_len);
        if ( 1 != sscanf(line,"vertex(%x).",&y) ) {
            croak(line);
        }

        /* Fetch parents */
        JLG(pxedge,rulledge,y);
        if ( pxedge ) {

            /* For each parent, find the best */
            best_x_arity = -1;
            best_x = -1;
            x = 0;
            J1F(found_x,*pxedge,x);
            while ( found_x ) {

                /* Fetch parent's arity */
                JLG(pxarity,arity,x);
                if ( pxarity ) {
                    /* Choose best parent */
                    if ( -1 == best_x
                         || best_x_arity < *pxarity
                         || ( best_x_arity == *pxarity && x < best_x ) ) {
                        best_x = x;
                        best_x_arity = *pxarity;
                    }
                }

                J1N(found_x,*pxedge,x);
            }

            /* Write best parent */
            PerlIO_printf(ofh,"edge(%x,%x).\n",best_x,y);
        }
        else {
            PerlIO_printf(ofh,"edge(0,%x).\n",y);
        }

    }
    SvREFCNT_dec(line_sv);
}

#ifndef PERL_UNUSED_VAR
#  define PERL_UNUSED_VAR(var) if (0) var = var
#endif

#line 76 "frame_deparent_4d18.c"

XS(XS_main_deparent); /* prototype to pass -Wmissing-prototypes */
XS(XS_main_deparent)
{
#ifdef dVAR
    dVAR; dXSARGS;
#else
    dXSARGS;
#endif
    if (items != 4)
       Perl_croak(aTHX_ "Usage: %s(%s)", "main::deparent", "ifh, ofh, rulledge, arity");
    PERL_UNUSED_VAR(cv); /* -W */
    PERL_UNUSED_VAR(ax); /* -Wall */
    SP -= items;
    {
	PerlIO *	ifh = IoIFP(sv_2io(ST(0)));
	PerlIO *	ofh = IoIFP(sv_2io(ST(1)));
	void *	rulledge = INT2PTR(void *,SvIV(ST(2)));
	void *	arity = INT2PTR(void *,SvIV(ST(3)));
#line 74 "frame_deparent_4d18.xs"
	I32* temp;
#line 98 "frame_deparent_4d18.c"
#line 76 "frame_deparent_4d18.xs"
	temp = PL_markstack_ptr++;
	deparent(ifh, ofh, rulledge, arity);
	if (PL_markstack_ptr != temp) {
          /* truly void, because dXSARGS not invoked */
	  PL_markstack_ptr = temp;
	  XSRETURN_EMPTY; /* return empty stack */
        }
        /* must have used dXSARGS; list context implied */
	return; /* assume stack size is correct */
#line 109 "frame_deparent_4d18.c"
	PUTBACK;
	return;
    }
}

#ifdef __cplusplus
extern "C"
#endif
XS(boot_frame_deparent_4d18); /* prototype to pass -Wmissing-prototypes */
XS(boot_frame_deparent_4d18)
{
#ifdef dVAR
    dVAR; dXSARGS;
#else
    dXSARGS;
#endif
    char* file = __FILE__;

    PERL_UNUSED_VAR(cv); /* -W */
    PERL_UNUSED_VAR(items); /* -W */
    XS_VERSION_BOOTCHECK ;

        newXS("main::deparent", XS_main_deparent, file);
    if (PL_unitcheckav)
         call_list(PL_scopestack_ix, PL_unitcheckav);
    XSRETURN_YES;
}

